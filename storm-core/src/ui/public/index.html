<html><head>
<title>Storm UI</title>
<link href="/css/bootstrap-1.4.0.css" rel="stylesheet" type="text/css">
<link href="/css/style.css" rel="stylesheet" type="text/css">
<script src="/js/jquery-1.6.2.min.js" type="text/javascript"></script>
<script src="/js/jquery.tablesorter.min.js" type="text/javascript"></script>
<script src="/js/jquery.cookies.2.2.0.min.js" type="text/javascript"></script>
<script src="/js/jquery.mustache.js" type="text/javascript"></script>
<script src="/js/bootstrap-twipsy.js" type="text/javascript"></script>
<script src="/js/script.js" type="text/javascript"></script>
</head>
<body>
<h1><a href="/">Storm UI</a></h1>
<h2>Cluster Summary</h2>
<div id="cluster-summary">
</div>
<h2>Topology summary</h2>
<div id="topology-summary">
</div>
<h2>Supervisor summary</h2>
<div id="supervisor-summary">
</div>
<h2>Nimbus Configuration</h2>
<div id="nimbus-configuration"></div>
<div id="error"></div>
</body>
<script>
$(document).ready(function() {
    $.ajaxSetup({
        "error":function(jqXHR,textStatus,response) {
            var errorJson = jQuery.parseJSON(jqXHR.responseText);
            $.get("/templates/error-template.html", function(template) {
                $("#error").append(Mustache.render($(template).filter("#error-template").html(),errorJson));
            });
        }
    });
    var template = $.get("/templates/index-page-template.html");
    var clusterSummary = $("#cluster-summary");
    var topologySummary = $("#topology-summary");
    var supervisorSummary = $("#supervisor-summary");
    var config = $("#nimbus-configuration");

    $.getJSON("/api/cluster/summary",function(response,status,jqXHR) {
        $.get("/templates/index-page-template.html", function(template) {
            clusterSummary.append(Mustache.render($(template).filter("#cluster-summary-template").html(),response));
        });
    });
    $.getJSON("/api/topology/summary",function(response,status,jqXHR) {
      $.get("/templates/index-page-template.html", function(template) {
          topologySummary.append(Mustache.render($(template).filter("#topology-summary-template").html(),response));
          if(response["topologies"].length > 0) {
              $("#topology-summary-table").tablesorter({ sortList: [[0,0]], headers: {3: { sorter: "stormtimestr"}}});
              }
      });
    });
    $.getJSON("/api/supervisor/summary",function(response,status,jqXHR) {
      $.get("/templates/index-page-template.html", function(template) {
          supervisorSummary.append(Mustache.render($(template).filter("#supervisor-summary-template").html(),response));
          if(response["supervisors"].length > 0) {
              $("#supervisor-summary-table").tablesorter({ sortList: [[0,0]], headers: {3: { sorter: "stormtimestr"}}});
          }
      });
    });
    $.getJSON("/api/cluster/configuration",function(response,status,jqXHR) {
      var formattedResponse = formatConfigData(response);
      $.get("/templates/index-page-template.html", function(template) {
          config.append(Mustache.render($(template).filter("#configuration-template").html(),formattedResponse));
          $("#nimbus-configuration-table").tablesorter({ sortList: [[0,0]], headers: {}});
      });
    });
  });
</script>
</html>
